---
import Layout from '@layouts/Neovim.astro';
import { projects } from "@cv";
---

<Layout title="Projects">
  <ul id="project-list">
    {projects && projects.map(({ url, description, highlights, name, isActive, github, stack}, index) => {
      return (
        <li class="mb-6 project-item leading-6 nvim-line" data-index={index} class:list={{'active': isActive, 'open-source': github}}>
          <div class="flex gap-2">
            {isActive ? (
              <a
                class="group flex items-center gap-[6px] text-lg decoration-dotted underline-offset-[5px] hover:underline transition-all duration-200 text-blue project-url"
                href={url}
                title={`Ver ${name}`}
                target="_blank"
              >
                {name}
                <span class="text-skin-hue transition ease-linear group-hover:translate-x-1 group-hover:no-underline">
                >
              </span>
              </a>
            ) : (
              <span class="text-lg text-blue">{name}</span>
            )}
            
            {github && (
              <a
                href={github}
                title={`View ${name} in GitHub`}
                aria-label={`View ${name} in GitHub`}
                target="_blank"
                rel="noopener"
                class="opacity-75 transition duration-200 hover:text-green decoration-dotted underline-offset-[8px] hover:underline repository-url"
              >
                <span>〔GITHUB〕</span>
              </a>
            )}
          </div>
            <div>
              {highlights && highlights.map(
                (highlight) =>
                  <span class="text-gray-600">{highlight.slice(3)}. </span> //Slice to remove emojis, remove if you don't use emojis
              )}
            </div>
            <p class="text-gray-500">
              {description}
            </p>
            
            <ul class="flex print:hidden flex-wrap gap-2 mt-6" aria-label="Technologies used">
              {stack && Object.entries(stack).map(([label], index) => (
                <li class=" cursor-default gap-2 bg-transparent border-nvim-green/60 text-green flex items-center border-solid border rounded-md px-2 py-1 text-xs backdrop-blur-sm">
                  <span>〔{index}〕</span>
                  <span>{label}</span>
                </li>
              ))}
            </ul>
          </li>
      )
    })}
  </ul>
</Layout>

<style>
  .project-item.active {
    background-color: rgba(0, 0, 0, 0.1);
  }
</style>

<script>
  let currentIndex = 0;
  const projectItems = document.querySelectorAll('.project-item');
  

  function moveCursor(direction: 1 | -1) {
    currentIndex += direction;
    if (currentIndex < 0) currentIndex = projectItems.length - 1;
    if (currentIndex >= projectItems.length) currentIndex = 0;
  }

  function enterProject() {
    const activeItem = projectItems[currentIndex].classList.contains('active') ? projectItems[currentIndex] : null;
    const openSourceItem = projectItems[currentIndex].classList.contains('open-source') ? projectItems[currentIndex] : null;
    if (activeItem) {
      const projectUrl: string | null | undefined = activeItem?.querySelector('.project-url')?.getAttribute('href');
      if (projectUrl) {
        window.location.href = projectUrl;
      }
    }
    if (openSourceItem) {
      const repositoryUrl: string | null | undefined = openSourceItem?.querySelector('.repository-url')?.getAttribute('href');
      if (repositoryUrl) {
        window.location.href = repositoryUrl;
      }
    }
  }
  
  document.addEventListener('keydown', (e: KeyboardEvent) => {
    switch (e.key) {
      case 'j':
        moveCursor(1);
        console.log(currentIndex)
        break;
      case 'k':
        moveCursor(-1);
        console.log(currentIndex)
        break;
      case 'Enter':
        enterProject();
        break;
    }
  })
  
</script>